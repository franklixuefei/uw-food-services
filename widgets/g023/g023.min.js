function g023(e,n){var r=$("div"+n);var i="https://api.uwaterloo.ca/v2/";var s={};var o=null;var u=false;var a=false;window.g023_gMapInitialize=function(){u=true};var f={key:"d47fe3afb19f506f5a95e89e99527595"};var l={getWeekdayString:function(){var e=new Date;var t=new Array(7);t[0]="sunday";t[1]="monday";t[2]="tuesday";t[3]="wednesday";t[4]="thursday";t[5]="friday";t[6]="saturday";return t[e.getDay()]},firstLetterCapitalizer:function(e){if(e.length===0)return e;return e[0].toUpperCase()+e.substr(1)},showAlert:function(e,t,n,r){var i=$(s.alertHtml);var o=$("<div>").attr("class","g023_mask g023_restaList");$(e).append(o);$(e).append(i);i.find(".g023_alert_header").text(t);i.find(".g023_alert_content").text(n);i.find("button").text(r).bind("click",function(){if(!a)return;i.fadeOut(300,function(){$(this).remove()});o.fadeOut(300,function(){$(this).remove()})})}};var c={_viewUpdaters:[],_restaInfoWithMenu:[],_restaInfoWithoutMenu:[],_restaMenus:[],_restaMenusDateInfo:{},addViewUpdater:function(e){this._viewUpdaters.push(e)},updateViews:function(e){for(var t=0;t<this._viewUpdaters.length;t++){this._viewUpdaters[t](e)}},_parseData:function(e,t,n,r,i){$("#g023").find(".g023_mask.g023_outer").remove();this._restaMenus=n.outlets;this._restaMenusDateInfo=n.date;for(var s in t){var o=false;for(var u in n.outlets){if(t[s].outlet_id===n.outlets[u].outlet_id){o=true;break}}if(o){if($.inArray(t[s],i._restaInfoWithMenu)===-1){if(t[s].outlet_name!=="UW Food Services Administrative Office"){i._restaInfoWithMenu.push(t[s]);console.log("pushed resta: "+t[s].outlet_name+" with id "+t[s].outlet_id)}}}else{if($.inArray(t[s],i._restaInfoWithoutMenu)===-1){if(t[s].outlet_name!=="UW Food Services Administrative Office"){i._restaInfoWithoutMenu.push(t[s]);console.log("pushed resta: "+t[s].outlet_name+" with id "+t[s].outlet_id)}}}}for(var a in i._restaInfoWithMenu){for(var u in e){if(i._restaInfoWithMenu[a].outlet_id===e[u].outlet_id){i._restaInfoWithMenu[a].has_breakfast=e[u].has_breakfast;i._restaInfoWithMenu[a].has_dinner=e[u].has_dinner;i._restaInfoWithMenu[a].has_lunch=e[u].has_lunch;break}}}for(var a in i._restaInfoWithoutMenu){for(var u in e){if(i._restaInfoWithoutMenu[a].outlet_id===e[u].outlet_id){i._restaInfoWithoutMenu[a].has_breakfast=e[u].has_breakfast;i._restaInfoWithoutMenu[a].has_dinner=e[u].has_dinner;i._restaInfoWithoutMenu[a].has_lunch=e[u].has_lunch;break}}}i._restaInfoWithMenu.sort(function(e,t){return e.outlet_name>t.outlet_name});i._restaInfoWithoutMenu.sort(function(e,t){return e.outlet_name>t.outlet_name});if(n.outlets.length===0){i.updateViews("vacation")}else{i.updateViews("")}if(r)r()},loadOutletData:function(e){$("#g023").append(s.loaderHtml);var t=this;var n=0;var r=3;var o=[];var u=[];var a=[];$.ajax({type:"GET",url:i+"foodservices/locations.json",data:f,dataType:"json",timeout:3e4,success:function(i){console.log("data retrieved from location&hours API:");console.log(i);if(i.meta.status===200){o=i.data;n++;if(n===r){n=0;t._parseData(a,o,u,e,t)}}else{t._restaInfoWithMenu=[];t._restaInfoWithoutMenu=[];t.updateViews("error")}},error:function(e,t){}});$.ajax({type:"GET",url:i+"foodservices/"+(new Date).getFullYear()+"/"+(new Date).getWeek()+"/menu.json",data:f,dataType:"json",timeout:3e4,success:function(i){console.log("data retrieved from menu API:");console.log(i);if(i.meta.status===200){n++;u=i.data;if(n===r){n=0;t._parseData(a,o,u,e,t)}}else{t._restaInfoWithoutMenu=[];t._restaMenus=[];t._restaMenusDateInfo={};t.updateViews("error")}},error:function(e,t){}});$.ajax({type:"GET",url:i+"foodservices/outlets.json",data:f,dataType:"json",timeout:3e4,success:function(i){console.log("data retrieved from outlets API:");console.log(i);if(i.meta.status===200){n++;a=i.data;if(n===r){n=0;t._parseData(a,o,u,e,t)}}else{t.updateViews("error")}},error:function(e,t){}})},getData:function(){var e=new Object;e.restaInfoWithMenu=this._restaInfoWithMenu;e.restaInfoWithoutMenu=this._restaInfoWithoutMenu;e.restaMenus=this._restaMenus;e.restaMenusDateInfo=this._restaMenusDateInfo;return e},clear:function(){console.log("restaListModel clear");this._viewUpdaters=[];this._restaInfoWithMenu=[];this._restaInfoWithoutMenu=[];this._restaMenus=[];this._restaMenusDateInfo={}}};var h={_viewUpdaters:[],_thisRestaMenu:[],_thisRestaInfo:{},initWithRestaInfo:function(e,t){this._thisRestaInfo=e;this._thisRestaMenu=t},addViewUpdater:function(e){this._viewUpdaters.push(e)},updateViews:function(e){for(var t=0;t<this._viewUpdaters.length;t++){this._viewUpdaters[t](e)}},_parseData:function(e,t,n,r){console.log("currentRestaMenu:");console.log(this._thisRestaMenu);if(t)t();r.updateViews("");if(n)n()},loadOfferingDetailData:function(e,t){var n=this;var r=0;var i=0;if(r===i){r=0;n._parseData([],e,t,n)}},getData:function(){var e=new Object;e.currentRestaMenu=this._thisRestaMenu;e.currentRestaInfo=this._thisRestaInfo;return e},clear:function(){console.log("restaOfferingsModel clear");this._viewUpdaters=[];this._thisRestaMenu=[];this._thisRestaInfo={}}};var p={_viewUpdaters:[],_thisProdInfo:{},initWithProdInfo:function(e){this._thisProdInfo=e},addViewUpdater:function(e){this._viewUpdaters.push(e)},updateViews:function(e){for(var t=0;t<this._viewUpdaters.length;t++){this._viewUpdaters[t](e)}},_parseData:function(e,t,n){$("#g023").find(".g023_mask.g023_outer").remove();for(var r in e){if(!e[r]){this._thisProdInfo[r]=0}else{this._thisProdInfo[r]=e[r]}}console.log("currentProdInfo:");console.log(this._thisProdInfo);n.updateViews("");if(t)t()},loadProdData:function(e){$("#g023").append(s.loaderHtml);var t=this;var n={};var r=0;var o=1;$.ajax({type:"GET",url:i+"foodservices/products/"+this._thisProdInfo.product_id+".json",data:f,dataType:"json",timeout:3e4,success:function(i){console.log("data retrieved from product API:");console.log(i);if(i.meta.status===200){r++;n=i.data;if(r===o){r=0;t._parseData(n,e,t)}}else{t.updateViews("error")}},error:function(e,t){}})},getData:function(){var e=new Object;e.currentProdInfo=this._thisProdInfo;return e},clear:function(){console.log("offeringDetailModel clear");this._viewUpdaters=[];this._thisProdInfo={}}};var d={_viewUpdaters:[],_thisRestaInfoArray:[],_zoom:0,initWithRestaInfo:function(e,t){this._thisRestaInfoArray.push(e);this._zoom=t},addViewUpdater:function(e){this._viewUpdaters.push(e)},updateViews:function(e){for(var t=0;t<this._viewUpdaters.length;t++){this._viewUpdaters[t](e)}},_parseData:function(e,t){console.log("currentRestaInfoArray:");console.log(this._thisRestaInfoArray);t.updateViews("");if(e)e()},loadMapData:function(e){var t=this;var n={key:"d47fe3afb19f506f5a95e89e99527595"};var r=0;var i=0;if(r===i){r=0;t._parseData(e,t)}},getData:function(){var e=new Object;e.currentRestaInfoArray=this._thisRestaInfoArray;e.zoom=this._zoom;return e},clear:function(){console.log("restaMapModel clear");this._viewUpdaters=[];this._thisRestaInfoArray=[]}};var v={_pageStack:[],pushPage:function(e){a=false;if(o)o.fadeOutPage();e.fadeInPage(function(){console.log("page pushed in");o=e;a=true});this._pageStack.push(e);if(this._pageStack.length>1){$("#g023").find(".g023_back").fadeIn(400)}else{$("#g023").find(".g023_back").fadeOut(400)}},popPage:function(){a=false;if(this._pageStack.length===1)return false;var e=this._pageStack.pop();o=this._pageStack[this._pageStack.length-1];o.fadeInPage();e.fadeOutPage(function(){e.destroy();a=true;console.log("page popped out")});if(this._pageStack.length>1){$("#g023").find(".g023_back").fadeIn(400)}else{$("#g023").find(".g023_back").fadeOut(400)}return true}};var m={_views:[],_model:null,_pageWrapper:null,addView:function(e){this._views.push(e)},initViews:function(e,t){var n=0;this._model=e;this._pageWrapper=$(s.restaListWrapperHtml);r.append(this._pageWrapper);console.log("here");var i=this;for(var o=0;o<this._views.length;++o){this._views[o].initView(this._pageWrapper,function(){n++;if(n===i._views.length){t()}})}},getModel:function(){return this._model},fadeInPage:function(e){if(e){this._pageWrapper.fadeIn(400,e)}else{this._pageWrapper.fadeIn(400)}},fadeOutPage:function(e){if(e){this._pageWrapper.fadeOut(400,e)}else{this._pageWrapper.fadeOut(400)}},destroy:function(){this._pageWrapper.remove();this._model.clear();this._views=[]}};var g={_pageObj:null,_LEFT_ARROW_FLAG:1,_RIGHT_ARROW_FLAG:2,_generateRestaItem:function(e,t,n){var r=Math.random()*15-7.5;var i=$("<div>").attr("class","g023_restaItemWrapper g023_note g023_sticky"+n%6).css("transform","rotate("+r+"deg)").css("-moz-transform","rotate("+r+"deg)").css("-webkit-transform","rotate("+r+"deg)").append($("<div>").attr("class","g023_pin")).append($("<div>").attr("class","g023_restaIconHolder").append($("<img>").attr("src",e.logo)).append($("<div>").attr("class","g023_restaDetail").append($("<span>").html("Today @ "+e.building+": <br><span style='font-size: 20px;'>"+(e.opening_hours[l.getWeekdayString()].is_closed===false?e.opening_hours[l.getWeekdayString()].opening_hour+" - "+e.opening_hours[l.getWeekdayString()].closing_hour:"<span style='margin-top: 2px; color:red;display:inline-block;font-size:16px;'>CLOSED TODAY</span>")+"</span>"))));i.bind("click",function(){if(!a)return;if(t==="menu"){var n=c.getData().restaMenus;var r={};for(var i=0;i<n.length;++i){if(n[i].outlet_id===e.outlet_id){r=n[i];break}}h.initWithRestaInfo(e,r);y.addView(b);y.initViews(h,function(){v.pushPage(y)})}else{console.log("I do not have menu!!");console.log(e);if(!u){l.showAlert(this._pageObj,"Error","Google API has not been fully loaded. Please try again later.","OK");return false}d.initWithRestaInfo(e,18);S.addView(x);S.initViews(d,function(){v.pushPage(S)})}});return i},_generateRestaList:function(){$(this._pageObj).find(".g023_sectionContent").children().remove();var e=c.getData().restaInfoWithMenu;for(var t=0;t<e.length;++t){var n=this._generateRestaItem(e[t],"menu",t);$(this._pageObj).find(".g023_sectionContent#with_menu").append(n)}var r=c.getData().restaInfoWithoutMenu;for(var t=0;t<r.length;++t){var n=this._generateRestaItem(r[t],"no_menu",t);$(this._pageObj).find(".g023_sectionContent#without_menu").append(n)}},updateView:function(e){if(e==="error"){t=s.restaListError}else if(e==="vacation"){console.log("VACATION TIME!!!!");var n=c.getData().restaInfoWithoutMenu;var r=$("<div>").attr("class","g023_vacation_restas_wrapper");$(g._pageObj).find("#g023_restaListContent").children().remove();$(g._pageObj).find("#g023_restaListContent").append(r);for(var i=0;i<n.length;++i){var o=g._generateRestaItem(n[i],"no_menu",i);r.append(o)}var u="School is closed due to vacation or holidays. But feel free to explore all restaurants!";l.showAlert(g._pageObj,"Notice",u,"OK")}else{g._generateRestaList();console.log("restaListModel Data");console.log(c.getData())}},_toggleArrowButton:function(e,t,n){if(n.scrollLeft===0){if(e)$(e).addClass("g023_arrow_disabled")}else{if(e)$(e).removeClass("g023_arrow_disabled")}if(n.scrollLeft===n.scrollLeftMax){if(t)$(t).addClass("g023_arrow_disabled")}else{if(t)$(t).removeClass("g023_arrow_disabled")}},initView:function(e,t){this._pageObj=e;console.log("Initializing restaListView");console.log($(s.restaListBaseHtml));$(this._pageObj).append(s.restaListBaseHtml);var n=this;var r=$(this._pageObj).find(".g023_overflow_wrapper.g023_overflow_upper");var i=$(this._pageObj).find(".g023_overflow_wrapper.g023_overflow_lower");var o=$(this._pageObj).find(".g023_left_arrow.g023_upper_row");var f=$(this._pageObj).find(".g023_right_arrow.g023_upper_row");var h=$(this._pageObj).find(".g023_left_arrow.g023_lower_row");var p=$(this._pageObj).find(".g023_right_arrow.g023_lower_row");o.bind("click",function(){if(!a)return;r.animate({scrollLeft:"-=166px"},400,function(){n._toggleArrowButton(o,f,r[0])})});f.bind("click",function(){if(!a)return;r.animate({scrollLeft:"+=166px"},400,function(){n._toggleArrowButton(o,f,r[0])})});h.bind("click",function(){if(!a)return;i.animate({scrollLeft:"-=166px"},400,function(){n._toggleArrowButton(h,p,i[0])})});p.bind("click",function(){if(!a)return;i.animate({scrollLeft:"+=166px"},400,function(){n._toggleArrowButton(h,p,i[0])})});c.addViewUpdater(this.updateView);c.loadOutletData(function(){$(n._pageObj).find(".g023_mapall").click(function(){if(!a)return;console.log("Map them! clicked!");console.log(c.getData());if(!u){l.showAlert(n._pageObj,"Error","Google API has not been fully loaded. Please try again later.","OK");return false}var e=c.getData().restaInfoWithMenu;var t=c.getData().restaInfoWithoutMenu;for(var r=0;r<e.length;++r){d.initWithRestaInfo(e[r],15)}for(var r=0;r<t.length;++r){d.initWithRestaInfo(t[r],15)}S.addView(x);S.initViews(d,function(){v.pushPage(S)})});t();if(!/Firefox/i.test(navigator.userAgent)&&!window.chrome){console.log("unsupported broswer!");n._pageObj.children().remove();l.showAlert(n._pageObj,"Error","UW Food Services Widget currently only supports Chrome or Firefox.","OK")}})}};var y={_views:[],_model:null,_pageWrapper:null,addView:function(e){this._views.push(e)},initViews:function(e,t){var n=0;this._model=e;this._pageWrapper=$(s.restaOfferingsWrapperHtml);r.append(this._pageWrapper);var i=this;for(var o=0;o<this._views.length;++o){this._views[o].initView(this._pageWrapper,function(){n++;if(n===i._views.length){n=0;t()}})}},getModel:function(){return this._model},fadeInPage:function(e){if(e){this._pageWrapper.fadeIn(400,e)}else{this._pageWrapper.fadeIn(400)}},fadeOutPage:function(e){if(e){this._pageWrapper.fadeOut(400,e)}else{this._pageWrapper.fadeOut(400)}},destroy:function(){this._pageWrapper.remove();this._model.clear();this._views=[]}};var b={_pageObj:null,_menuOfDay:{},_selectedDay:l.getWeekdayString(),_selectedDayIndex:0,_weekdayArray:[],_withinCurrentWeek:false,height:0,toggle:false,_generateOfferingItem:function(e,t,n){var r=Math.random()*12-6;var i=null;if(t==="no_lunch"||t==="no_dinner"){i=$("<div>").attr("class","g023_offeringItemWrapper g023_note g023_stickyGray").css("transform","rotate("+r+"deg)").css("-moz-transform","rotate("+r+"deg)").css("-webkit-transform","rotate("+r+"deg)").append($("<div>").attr("class","g023_pin")).append($("<div>").attr("class","g023_offering").append($('<span class="g023_no_meal">').text(h.getData().currentRestaMenu.outlet_name+" does not provide "+(t==="no_lunch"?"lunch":"dinner")+" on "+this._menuOfDay.day)))}else if(t==="lunch_no_detail"||t==="dinner_no_detail"){i=$("<div>").attr("class","g023_offeringItemWrapper g023_note g023_stickyBlue").css("transform","rotate("+r+"deg)").css("-moz-transform","rotate("+r+"deg)").css("-webkit-transform","rotate("+r+"deg)").append($("<div>").attr("class","g023_pin")).append($("<div>").attr("class","g023_offering").append($('<span class="g023_meal_no_detail">').text(h.getData().currentRestaMenu.outlet_name+" provides "+(t==="lunch_no_detail"?"lunch":"dinner")+" on "+this._menuOfDay.day+". Go check it out!")))}else{i=$("<div>").attr("class","g023_offeringItemWrapper g023_note g023_sticky"+n%6).css("transform","rotate("+r+"deg)").css("-moz-transform","rotate("+r+"deg)").css("-webkit-transform","rotate("+r+"deg)").append($("<div>").attr("class","g023_pin")).append($("<div>").attr("class","g023_offering").append($('<span class="g023_normal">').text(e.product_name)))}var s=this;i.bind("click",function(){if(!a)return;console.log("product clicked:");console.log(e);if(e){if(e.product_id){p.initWithProdInfo(e);w.addView(E);w.initViews(p,function(){v.pushPage(w)})}else{console.log("this product does not have details!!!");l.showAlert(s._pageObj,"Notice",'Ingredients and Value Facts for "'+e.product_name+'" is not available.',"OK")}}});return i},_generateOfferingList:function(){this._clearMenu();console.log("selectedDay: "+this._selectedDay);console.log("menuOfDay: ");console.log(this._menuOfDay);if(!h.getData().currentRestaInfo.has_lunch){var e=this._generateOfferingItem(null,"no_lunch");$(this._pageObj).find(".g023_sectionContent#g023_lunch").append(e)}else{for(var t=0;t<this._menuOfDay.meals.lunch.length;++t){var n=this._generateOfferingItem(this._menuOfDay.meals.lunch[t],"lunch",t);$(this._pageObj).find(".g023_sectionContent#g023_lunch").append(n)}if(this._menuOfDay.meals.lunch.length===0){var r=this._generateOfferingItem(null,"lunch_no_detail");$(this._pageObj).find(".g023_sectionContent#g023_lunch").append(r)}}if(!h.getData().currentRestaInfo.has_dinner){var i=this._generateOfferingItem(null,"no_dinner");$(this._pageObj).find(".g023_sectionContent#g023_dinner").append(i)}else{for(var t=0;t<this._menuOfDay.meals.dinner.length;++t){var s=this._generateOfferingItem(this._menuOfDay.meals.dinner[t],"dinner",t);$(this._pageObj).find(".g023_sectionContent#g023_dinner").append(s)}if(this._menuOfDay.meals.dinner.length===0){var r=this._generateOfferingItem(null,"dinner_no_detail");$(this._pageObj).find(".g023_sectionContent#g023_dinner").append(r)}}},_clearMenu:function(){$(this._pageObj).find(".g023_sectionContent").children().remove()},_handleDayChange:function(e){this._clearMenu();if(e){this._selectedDayIndex=(this._selectedDayIndex+1)%this._weekdayArray.length}else{this._selectedDayIndex=((this._selectedDayIndex-1)%this._weekdayArray.length+this._weekdayArray.length)%this._weekdayArray.length}this._selectedDay=this._weekdayArray[this._selectedDayIndex];this._menuOfDay=h.getData().currentRestaMenu.menu[this._selectedDayIndex];this.updateView("")},_setWeekdayArray:function(e){var t=this._weekdayArray.length;this._weekdayArray.splice(0,t);for(var n=0;n<e.length;++n){this._weekdayArray.push(e[n].day)}console.log("weekday array:");console.log(this._weekdayArray)},_autoSelectDayMenu:function(){console.log("menus date info:");console.log(c.getData().restaMenusDateInfo);var e=h.getData().currentRestaMenu;var t=(new Date).getTime();var n=(new Date(c.getData().restaMenusDateInfo.start)).getTimeWithCurrentTimezone();var r=(new Date(c.getData().restaMenusDateInfo.end)).getTimeWithCurrentTimezone()+24*60*60*1e3;if(t>=n&&t<r){console.log("today is still within current week");for(var i=0;i<e.menu.length;++i){this._menuOfDay=e.menu[i];if(this._menuOfDay.day.toLowerCase()===this._selectedDay){this._selectedDayIndex=i;break}}return true}else{console.log("this week has passed, showing menu of later dates");this._selectedDay=e.menu[0].day.toLowerCase();this._menuOfDay=e.menu[0];this._selectedDayIndex=0;return false}console.log("impossible to reach here!!!");return false},updateView:function(e){if(e==="error"){t=s.restaOfferingsError}else{console.log("restaOfferingsModel Data");console.log(h.getData());$(b._pageObj).find(".g023_resta_name").text(h.getData().currentRestaMenu.outlet_name);if(b._menuOfDay.notes){$(b._pageObj).find(".g023_info_content").find(".g023_notes").show();$(b._pageObj).find(".g023_info_content").find(".g023_notes").html(b._menuOfDay.notes)}else{$(b._pageObj).find(".g023_info_content").find(".g023_notes").hide()}console.log("with current week?");console.log(b._withinCurrentWeek);$(b._pageObj).find(".g023_resta_day").text((b._withinCurrentWeek?"":"next ")+l.firstLetterCapitalizer(b._selectedDay));b._generateOfferingList();b.toggle=false;b.height=$(b._pageObj).find(".g023_info.g023_note").height();$(b._pageObj).find(".g023_info_wrapper").css("top",25-(10+b.height))}},_toggleArrowButton:function(e,t,n){if(n.scrollLeft===0){if(e)$(e).addClass("g023_arrow_disabled")}else{if(e)$(e).removeClass("g023_arrow_disabled")}if(n.scrollLeft===n.scrollLeftMax){if(t)$(t).addClass("g023_arrow_disabled")}else{if(t)$(t).removeClass("g023_arrow_disabled")}},initView:function(e,t){this._pageObj=e;console.log("Initializing restaOfferingsView");console.log($(s.restaOfferingsBaseHtml));$(this._pageObj).append(s.restaOfferingsBaseHtml);var n=this;var r=$(this._pageObj).find(".g023_overflow_wrapper.g023_overflow_upper");var i=$(this._pageObj).find(".g023_overflow_wrapper.g023_overflow_lower");var o=$(this._pageObj).find(".g023_left_arrow.g023_upper_row");var f=$(this._pageObj).find(".g023_right_arrow.g023_upper_row");var c=$(this._pageObj).find(".g023_left_arrow.g023_lower_row");var p=$(this._pageObj).find(".g023_right_arrow.g023_lower_row");o.bind("click",function(){if(!a)return;r.animate({scrollLeft:"-=180px"},400,function(){n._toggleArrowButton(o,f,r[0])})});f.bind("click",function(){if(!a)return;r.animate({scrollLeft:"+=180px"},400,function(){n._toggleArrowButton(o,f,r[0])})});c.bind("click",function(){if(!a)return;i.animate({scrollLeft:"-=180px"},400,function(){n._toggleArrowButton(c,p,i[0])})});p.bind("click",function(){if(!a)return;i.animate({scrollLeft:"+=180px"},400,function(){n._toggleArrowButton(c,p,i[0])})});$(this._pageObj).find(".g023_selector_arrows#g023_right").click(function(){if(!a)return;n._handleDayChange(true)});$(this._pageObj).find(".g023_selector_arrows#g023_left").click(function(){if(!a)return;n._handleDayChange(false)});$(this._pageObj).find(".g023_info_handle").click(function(){if(!a)return;if(!n.toggle){$(n._pageObj).find(".g023_info_wrapper").css("top",25)}else{$(n._pageObj).find(".g023_info_wrapper").css("top",25-(10+n.height))}n.toggle=!n.toggle});$(this._pageObj).click(function(e){if(!a)return;if(n.toggle){if(e.target.className.indexOf("g023_desc")===-1&&e.target.className.indexOf("g023_notes")===-1&&e.target.className.indexOf("g023_notice")===-1&&e.target.className.indexOf("g023_special_hours")===-1&&e.target.className.indexOf("g023_dates_closed")===-1&&e.target.className.indexOf("g023_info_handle")===-1){$(n._pageObj).find(".g023_info_wrapper").css("top",25-(10+n.height));n.toggle=false}}});h.addViewUpdater(this.updateView);h.loadOfferingDetailData(function(){console.log("callfront");n._setWeekdayArray(h.getData().currentRestaMenu.menu);n._withinCurrentWeek=n._autoSelectDayMenu();$(n._pageObj).find(".g023_info_content").find(".g023_desc").html(h.getData().currentRestaInfo.description);var e=h.getData().currentRestaInfo.notice;if(e){$(n._pageObj).find(".g023_info_content").find(".g023_notice").show();$(n._pageObj).find(".g023_info_content").find(".g023_notice").html(e)}else{$(n._pageObj).find(".g023_info_content").find(".g023_notice").hide()}var t=h.getData().currentRestaInfo.special_hours;if(t.length){$(n._pageObj).find(".g023_info_content").find(".g023_special_hours").show();$(n._pageObj).find(".g023_info_content").find(".g023_special_hours").append($("<div>").attr("class","g023_special_hours_title").text("Special Hours:"));for(var r=0;r<t.length;++r){var i=$("<div>").attr("class","g023_special_hour").text(t[r].opening_hour+" - "+t[r].closing_hour+" @ "+t[r].date);$(n._pageObj).find(".g023_info_content").find(".g023_special_hours").append(i)}}else{$(n._pageObj).find(".g023_info_content").find(".g023_special_hours").hide()}var s=h.getData().currentRestaInfo.dates_closed;if(s.length){$(n._pageObj).find(".g023_info_content").find(".g023_dates_closed").show();$(n._pageObj).find(".g023_info_content").find(".g023_dates_closed").append($("<div>").attr("class","g023_dates_closed_title").text("Dates Closed:"));for(var r=0;r<s.length;++r){if(!s[r])continue;var o=$("<div>").attr("class","g023_date_closed").text(s[r]);$(n._pageObj).find(".g023_info_content").find(".g023_dates_closed").append(o)}}else{$(n._pageObj).find(".g023_info_content").find(".g023_dates_closed").hide()}setTimeout(function(){n.height=$(n._pageObj).find(".g023_info.g023_note").height();$(n._pageObj).find(".g023_info_wrapper").css("top",25-(10+n.height))});$(n._pageObj).find("#g023_mapit").click(function(){if(!a)return;console.log("Map It! clicked!");if(!u){l.showAlert(n._pageObj,"Error","Google API has not been fully loaded. Please try again later.","OK");return false}var e=h.getData().currentRestaInfo;d.initWithRestaInfo(e,18);S.addView(x);S.initViews(d,function(){v.pushPage(S)})})},t)}};var w={_views:[],_model:null,_pageWrapper:null,addView:function(e){this._views.push(e);console.log("offeringDetailViewController addView")},initViews:function(e,t){var n=0;this._model=e;this._pageWrapper=$(s.restaProdWrapperHtml);r.append(this._pageWrapper);var i=this;for(var o=0;o<this._views.length;++o){this._views[o].initView(this._pageWrapper,function(){n++;if(n===i._views.length){t()}})}},getModel:function(){return this._model},fadeInPage:function(e){if(e){this._pageWrapper.fadeIn(400,e)}else{this._pageWrapper.fadeIn(400)}},fadeOutPage:function(e){if(e){this._pageWrapper.fadeOut(400,e)}else{this._pageWrapper.fadeOut(400)}},destroy:function(){this._pageWrapper.remove();this._model.clear();this._views=[]}};var E={_pageObj:null,updateView:function(e){if(e==="error"){}else{var t=p.getData();console.log("offeringDetailModel Data");console.log(t);if(!t.currentProdInfo.diet_type){t.currentProdInfo.diet_type="Non Vegetarian"}var n=$(Mustache.render(s.valueFact,t));$(E._pageObj).find("#g023_restaProdContent").append(n);var r=$(Mustache.render(s.ingredients,t));if(!t.currentProdInfo.ingredients){r.find(".g023_ingredients_list").hide()}if(!t.currentProdInfo.micro_nutrients){r.find(".g023_micro_nutrients").hide()}if(!t.currentProdInfo.tips){r.find(".g023_tips").hide()}$(E._pageObj).find("#g023_restaProdContent").append(r)}},initView:function(e,t){this._pageObj=e;console.log("Initializing offeringDetailView");console.log($(s.restaProdBaseHtml));$(this._pageObj).append(s.restaProdBaseHtml);var n=this;p.addViewUpdater(this.updateView);p.loadProdData(t)}};var S={_views:[],_model:null,_pageWrapper:null,addView:function(e){this._views.push(e)},initViews:function(e,t){var n=0;this._model=e;this._pageWrapper=$(s.restaMapWrapperHtml);r.append(this._pageWrapper);var i=this;for(var o=0;o<this._views.length;++o){this._views[o].initView(this._pageWrapper,function(){n++;if(n===i._views.length){t()}})}},getModel:function(){return this._model},fadeInPage:function(e){if(e){this._pageWrapper.fadeIn(400,e)}else{this._pageWrapper.fadeIn(400)}},fadeOutPage:function(e){if(e){this._pageWrapper.fadeOut(400,e)}else{this._pageWrapper.fadeOut(400)}},destroy:function(){this._pageWrapper.remove();this._model.clear();this._views=[]}};var x={_pageObj:null,updateView:function(e){if(e==="error"){}else{var t="";var n=[];var r=[];var i="";var s="";var o=null;var u=0;console.log("restaMapModel Data");console.log(d.getData());var a=d.getData().currentRestaInfoArray;for(var f=0;f<a.length;++f){var l=a[f].latitude;var c=a[f].longitude;console.log("lat and long of "+a[f].outlet_name);console.log(l);console.log(c);var h=new google.maps.LatLng(l,c);r.push(h);if(f==Math.floor(a.length/2)){i=h}}console.log("centered dest");console.log(i);s={zoom:d.getData().zoom,center:i};$("#g023_mapCanvas").css("height",460).css("width",876);t=new google.maps.Map(document.getElementById("g023_mapCanvas"),s);for(var f=0;f<r.length;++f){setTimeout(function(){p()},f*200)}function p(){console.log("destarr");console.log(r[u]);var e=new google.maps.Marker({position:r[u],map:t,animation:google.maps.Animation.DROP,title:a[u].outlet_name});n.push(e);var i='<div id="g023_gmap_content">'+'<div id="g023_gmap_siteNotice">'+"</div>"+'<h3 id="g023_gmap_firstHeading" class="g023_gmap_firstHeading">'+a[u].outlet_name+"</h1>"+'<div id="g023_gmap_bodyContent">'+'<img src="'+a[u].logo+'" style="display:inline-block; float:left;"/>'+'<p style="float:right;display: inline-block; margin-left: 30px; max-width: 444px;">'+(a[u].description?a[u].description:"")+"</p>";"</div>"+"</div>";google.maps.event.addListener(e,"click",function(){if(o){o.close();o=null}o=new google.maps.InfoWindow({content:i});o.open(t,e)});u++}setTimeout(function(){google.maps.event.trigger(t,"resize");t.setCenter(i)});google.maps.event.addListener(t,"click",function(){if(o){o.close();o=null}})}},initView:function(e,t){this._pageObj=e;console.log("Initializing restaMapView");console.log($(s.restaMapBaseHtml));$(this._pageObj).append(s.restaMapBaseHtml);var n=this;d.addViewUpdater(this.updateView);d.loadMapData(t)}};console.log("Initializing sample("+e+", "+n+")");portal.loadTemplates("widgets/g023/templates.json",function(e){s=e;r.append(s.foodServicesHeaderHtml);$("#g023").find(".g023_back").bind("click",function(){if(!a)return;v.popPage()});m.addView(g);m.initViews(c,function(){v.pushPage(m)});var t=document.createElement("link");t.setAttribute("rel","stylesheet");t.setAttribute("type","text/css");t.setAttribute("href","https://fonts.googleapis.com/css?family=Great+Vibes");document.getElementById("g023").appendChild(t);var n=document.createElement("script");n.type="text/javascript";n.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDexCumNi0oj_HqehCixRwTfl-Ae2EIC8A&sensor=false&callback=g023_gMapInitialize";document.getElementById("g023").appendChild(n)});if(!Date.prototype.getWeek){Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this-e)/864e5+e.getDay()+1)/7)}}if(!Date.prototype.getTimeWithCurrentTimezone){Date.prototype.getTimeWithCurrentTimezone=function(){return this.getTime()+this.getTimezoneOffset()*60*1e3}}}